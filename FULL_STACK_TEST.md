# 全栈测试指南

## 📋 前置条件

1. ✅ 后端服务已配置并运行在 `http://localhost:3000`
2. ✅ MongoDB 连接正常
3. ✅ 所有环境变量已配置（`.env`）

## 🚀 启动步骤

### 1. 启动后端服务

```bash
cd backend
npm start
```

**预期输出：**
```
✅ MongoDB 连接成功
🚀 服务器运行在端口 3000
✅ 启动完成，等待请求...
```

### 2. 启动前端服务

```bash
cd frontend
npm install  # 首次运行需要安装依赖
npm run dev
```

**预期输出：**
```
  VITE v5.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

### 3. 打开浏览器

访问 `http://localhost:5173`

## 🧪 测试场景

### 场景 1：视频解析生成菜谱 ⭐

1. **操作**：在"探索"页面输入视频链接
   - 测试链接：`https://www.bilibili.com/video/BV1Kf6FB5EuS/`
   
2. **预期行为**：
   - 点击"开始生成菜谱"后显示加载动画
   - 1-2 分钟后显示生成的菜谱详情
   - 菜谱包含：标题、描述、食材清单、烹饪步骤、tips（如有）

3. **验证点**：
   - ✅ 后端日志显示视频解析成功
   - ✅ 音频下载和 OSS 上传成功（如果配置了 OSS）
   - ✅ ASR 转写成功
   - ✅ 通义千问生成菜谱成功
   - ✅ 前端正确显示所有字段

### 场景 2：浏览灵感菜谱

1. **操作**：切换到"灵感"标签页

2. **预期行为**：
   - 显示按"早餐"、"午餐"、"晚餐"分类的菜谱
   - 可以点击菜谱卡片查看详情

3. **验证点**：
   - ✅ 后端返回灵感列表
   - ✅ 前端正确渲染分类和卡片

### 场景 3：收藏功能

1. **操作**：
   - 在菜谱详情页点击收藏按钮（❤️）
   - 切换到"收藏"标签页查看

2. **预期行为**：
   - 收藏成功显示 Toast 提示
   - "收藏"页面显示已收藏的菜谱
   - 长按收藏卡片可以删除

3. **验证点**：
   - ✅ 后端 API `/api/favorite` 调用成功
   - ✅ 数据库正确保存收藏关系
   - ✅ 前端状态正确更新

### 场景 4：错误处理

1. **测试无效视频链接**：
   - 输入无效链接或非视频链接
   - 预期：显示错误提示

2. **测试非美食视频**：
   - 输入非美食相关视频
   - 预期：显示"请上传美食/烹饪相关的视频"错误

3. **测试网络错误**：
   - 停止后端服务
   - 预期：前端显示友好的错误提示

## 🔍 调试技巧

### 查看后端日志

后端会输出详细的处理日志：

```
📹 开始解析视频: https://...
✅ yt-dlp 解析成功: ...
🎵 下载视频音频...
☁️ 上传音频到 OSS...
✅ 已得到可访问音频 URL...
🎤 正在 ASR 转写...
🤖 开始生成菜谱...
📝 正在通义千问生成菜谱...
```

### 查看前端网络请求

1. 打开浏览器开发者工具（F12）
2. 切换到 "Network" 标签
3. 查看 API 请求和响应

### 常见问题排查

**问题：前端无法连接后端**
- ✅ 检查后端是否运行在 `http://localhost:3000`
- ✅ 检查 `vite.config.ts` 中的代理配置
- ✅ 检查浏览器控制台是否有 CORS 错误

**问题：视频解析失败**
- ✅ 检查后端日志中的错误信息
- ✅ 确认 OSS 配置正确（如果使用 yt-dlp + OSS）
- ✅ 确认 ASR 配置正确
- ✅ 确认通义千问 API Key 正确

**问题：收藏功能不工作**
- ✅ 检查后端 `/api/favorite` 路由是否正常
- ✅ 检查用户认证中间件是否正常工作
- ✅ 查看浏览器 Network 标签中的请求状态

## 📊 API 端点测试（使用 curl）

### 测试视频解析

```bash
curl -X POST http://localhost:3000/api/video/parse \
  -H "Content-Type: application/json" \
  -H "x-wechat-code: test-code" \
  -d '{"url": "https://www.bilibili.com/video/BV1Kf6FB5EuS/"}'
```

### 测试获取灵感列表

```bash
curl http://localhost:3000/api/inspiration/list
```

### 测试获取收藏列表

```bash
curl -H "x-wechat-code: test-code" \
  http://localhost:3000/api/favorite
```

## ✅ 测试检查清单

- [ ] 后端服务正常启动
- [ ] 前端服务正常启动
- [ ] 视频解析功能正常
- [ ] 灵感列表正常显示
- [ ] 收藏功能正常
- [ ] 错误处理正常
- [ ] 移动端 UI 显示正常
- [ ] 动画效果流畅

## 🎯 下一步

测试通过后，可以：

1. **部署后端**：配置生产环境域名和 HTTPS
2. **部署前端**：构建并部署到静态托管服务
3. **配置微信小程序**：将前端代码迁移到微信小程序框架
4. **性能优化**：优化加载速度和用户体验
